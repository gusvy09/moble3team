<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>회원가입</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">


    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500&family=Roboto:wght@500;700;900&display=swap"
        rel="stylesheet">

    <!-- Icon Font Stylesheet -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    
    <!-- Libraries Stylesheet -->
    <link href="../static/lib/animate/animate.min.css" rel="stylesheet">
    <link href="../static/lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
    
    <!-- Customized Bootstrap Stylesheet -->
    <link href="../static/css/bootstrap.min.css" rel="stylesheet">

    <!-- Template Stylesheet -->
    <link href="../static/css/style.css" rel="stylesheet">
    
</head>

<body>
    <!-- Topbar Start -->
    <div class="container-fluid bg-dark px-5">
        <div class="row gx-4 d-none d-lg-flex">
            <div class="col-lg-6 text-start">
                <div class="h-100 d-inline-flex align-items-center py-3 me-4">
                    <div class="btn-sm-square rounded-circle bg-primary me-2">
                        <small class="fa fa-map-marker-alt text-white"></small>
                    </div>
                    <small>천안 동남구 대흥로 255</small>
                </div>
                <div class="h-100 d-inline-flex align-items-center py-3">
                    <div class="btn-sm-square rounded-circle bg-primary me-2">
                        <small class="fa fa-envelope-open text-white"></small>
                    </div>
                    <small>wnqktmvb@naver.com</small>
                </div>
            </div>
            <div class="col-lg-6 text-end">
                <div class="h-100 d-inline-flex align-items-center py-3 me-4">
                    <div class="btn-sm-square rounded-circle bg-primary me-2">
                        <small class="fa fa-phone-alt text-white"></small>
                    </div>
                    <small>010-3048-8258</small>
                </div>
                <div class="h-100 d-inline-flex align-items-center py-3">
                    <div class="btn-sm-square rounded-circle bg-primary me-2">
                        <small class="far fa-clock text-white"></small>
                    </div>
                    <small>Mon - Fri : 10AM - 7PM</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Start -->
    <div class="container-fluid bg-light overflow-hidden px-lg-0">
        <div class="container quote px-lg-0">
            <div class="row g-0 mx-lg-0 justify-content-center align-items-center">
                <a href="/" class="btn btn-primary btn-lg-square rounded-circle"><i
                        class="fa fa-arrow-left"></i></a>


                <div class="col-lg-6 p-lg-5">
                    <div class="bg-primary mb-3" style="width: 90px; height: 2px;"></div>
                    <h1 class="display-5 mb-2">회원가입</h1>
                    <p class="mb-3 pb-1"></p>
                    <form class="form-signin" action="/register" method="POST">
                        <div class="row g-3">
                            <div class="col-12 ">
                                <div class="col-12 d-flex justify-content-between">
                                    <input type="text" class="form-control border-0" name="newID" id="newID" placeholder="아이디"
                                        style="height: 55px;">
                                    <div style="width: 40px;"></div>
                                    <button class="btn btn-primary" type="submit" id="checkDuplicateBtn"
                                        style="min-width:100px;">중복 확인</button>
                                </div>
                                <div class="col-12" id="IdcheckFields">
                                </div>
                            </div>
                            <div class="col-12">
                                <input type="password" class="form-control border-0" name="newPW" id="newPW" placeholder="비밀번호"
                                    style="height: 55px;">
                            </div>
                            <div class="col-12 mb-2">
                                <input type="password" class="form-control border-0" id="newPWcheck" placeholder="비밀번호 확인"
                                    style="height: 55px;">
                                <div class="col-12" id="PWmatchcheck"></div>
                            </div>
                            <div class="col-12">
                                <div>
                                    <h6 class="display-7" style="color: gray;">본인 인증 </h6>
                                </div>
                                <input type="text" class="form-control border-0" id ="Username" placeholder="이름"
                                    style="height: 55px;">
                            </div>
                            <div class="col-12 d-flex justify-content-between">
                                <input type="email" class="form-control border-0" id="emailaddress" placeholder="이메일 주소"
                                    style="height: 55px;">
                                <div style="width: 40px;"></div>
                                <button class="btn btn-primary" type="button" id="numbercheckbtn"
                                    style="min-width:100px;">인증 요청</button>
                            </div>                            
                            <div class="col-12" id="verificationFields" style="display: none;">
                                <div class="col-12 d-flex justify-content-between">
                                    <input type="text" class="form-control border-0" id="usernum" placeholder="인증 번호" style="height: 50px;">
                                    <div style="width: 40px;"></div>
                                    <button class="btn btn-primary" type="button" id="numbercheck" style="min-width: 100px;">확인</button>
                                </div>
                            </div>
                            <div class = "col-12"> </div>
                            </div>
                            <div class="col-12">
                                <button class="btn btn-primary w-100 py-3" type="submit" id="complete_regist">회원가입</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!--/*** This template is free as long as you keep the footer author’s credit link/attribution link/backlink. If you'd like to use the template without the footer author’s credit link/attribution link/backlink, you can purchase the Credit Removal License from "https://htmlcodex.com/credit-removal". Thank you for your support. ***/-->
    <!--Designed By <a class="border-bottom" href="https://htmlcodex.com">HTML Codex</a>
    </div>
    </div>
    </div>
    </div> -->
    <!-- Copyright End -->

    <!-- 이벤트 발생 시 -->
    <script>
        // 아이디 정규식
        document.getElementById("newID").addEventListener("input",function() {
            var user_newID = document.getElementById("newID").value;
            var clean_newID = user_newID.replace(/[^A-Za-z0-9]/g,"");
            if(user_newID != clean_newID){
                alert("영어와 숫자 이외의 문자는 입력할 수 없습니다.");
            }
            document.getElementById("newID").value = clean_newID;
        });
        // 비밀번호 정규식
        document.getElementById("newPW").addEventListener("input",function() {
            var user_newPW = document.getElementById("newPW").value;
            var clean_newPW = user_newPW.replace(/[^A-Za-z0-9-~!@#$%^&*]/g,"");
            clean_newPW = clean_newPW.slice(0,20);
            if(user_newPW != clean_newPW){
                alert("최대 20글자이고,\n특수문자는 ~!@#$%^&*만 입력가능합니다.");
            }
            document.getElementById("newPW").value = clean_newPW;
        });

        // 이름 정규식
        document.getElementById("Username").addEventListener("input",function() {
            var username = document.getElementById("Username").value;            
            var cleanusername = username.replace(/[^가-힣ㄱ-하-ㅣ]/g,"");
            if(username != cleanusername){
                alert("한글 이외의 문자는 입력할 수 없습니다.");
            }
            document.getElementById("Username").value = cleanusername;
        });        
    </script>

    <script>
        // 중복확인 버튼 클릭 이벤트
        document.getElementById("checkDuplicateBtn").addEventListener("click", function () {
        var user_id = document.getElementById("newID").value;
        const checktext = document.getElementById("IdcheckFields");
        // AJAX 요청을 보냄
        $.ajax({
            type: "POST",
            url: "/register", // 서버의 경로 (app.py에서 처리할 경로)
            data: { newID: user_id }, // newID이름의 데이터, user_id 변수의 값으로 설정하여 데이터 전송
            success: function (response) {         
                if (response['result'] == "duplicate") {
                    // 아이디가 중복될 경우 처리                    
                    checktext.innerHTML = '<h6 class="display-7" id="IdcheckFields" style="color: red;">이미 사용 중인 아이디입니다.</h6>';                    
                }else if(response['result'] == "no_blank"){
                    checktext.innerHTML = '<h6 class="display-7" id="IdcheckFields" style="color: red;">공백은 아이디로 사용할 수 없습니다.</h6>';                   
                }
                else {
                    // 아이디가 중복되지 않을 경우 처리
                    checktext.innerHTML = '<h6 class="display-7" id="IdcheckFields" style="color: green;">사용 가능한 아이디입니다.</h6>';
                }                
            }
        });
        event.preventDefault(); //기본 동작(페이지 새로고침) 중지
        // 폼 초기화 방지
        return false;
    });
    </script>
    
    <!-- 비밀번호 일치 확인 -->
    <script>
        var pw_input_check = false;
        document.getElementById("newPWcheck").addEventListener("input",function() {
            pwmatchtext();
        });
        document.getElementById("newPW").addEventListener("input",function() {
            pwmatchtext();
        });
        function pwmatchtext(){
            var password = document.getElementById("newPW").value;
            var passwordcheck = document.getElementById("newPWcheck").value;
            var passwordmatchcheck = document.getElementById("PWmatchcheck");

            if(password.length > 7){
                if(password == passwordcheck) {
                    passwordmatchcheck.textContent = "비밀번호 일치";
                    passwordmatchcheck.style.color = "green";
                    pw_input_check = true;
                    if(password == "" && passwordcheck == ""){
                        passwordmatchcheck.textContent = "";
                        pw_input_check = false;
                    }
                }else {
                    passwordmatchcheck.textContent = "비밀번호 불일치";
                    passwordmatchcheck.style.color = "red";
                    pw_input_check = false;
                }
            }
            else{
                passwordmatchcheck.textContent = "최소 8글자 이상이어야 합니다.";
                passwordmatchcheck.style.color = "red";
                pw_input_check = false;
            }
        }
    </script>

    <script>
        var allcomplete = false;
        // 인증 요청 버튼 클릭 이벤트
        var verificationField = document.getElementById("verificationFields");
        var randomnumber = 0;
        document.getElementById("numbercheckbtn").addEventListener("click", function () {        
            // 이메일 정규식
            var db_emails = "{{db_user_email}}";
            var email = document.getElementById("emailaddress").value;
            var emailpattern = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
            var user_name = document.getElementById("Username").value;  
            if (!email.match(emailpattern)) {
                alert("올바른 이메일 주소를 입력하세요.");
                document.getElementById("emailaddress").value = "";
                document.getElementById("emailaddress").focus();                
            }
            else if(db_emails.includes(email)){
                alert("중복된 이메일입니다.");
                document.getElementById("emailaddress").value = ""; 
                document.getElementById("emailaddress").focus();
            }
            else if(user_name == ""){
                alert("이름을 확인해주세요");                    
            }
            else{                  
                alert("인증 요청했습니다!\n이메일에서 인증 번호를 확인해주세요");
                // 숨겨진 인증 번호 입력 필드를 보이게 만듭니다.
                verificationField.style.display = "block";
                // 새로운 인증 번호 생성
                randomnumber = Math.floor(1000 + Math.random() * 9000); 
                var addemailaddress = document.getElementById("emailaddress").value;
                $.ajax({
                    type: "POST",
                    url: "/register",
                    data: {randomnumber:randomnumber,
                        addemailaddress:addemailaddress}
                });                       
            }                
        });
        //인증 번호 일치 확인
        document.getElementById("verificationFields").addEventListener("click",function(e){
            if(e.target.id == "numbercheck"){
                var usernumber = document.getElementById("usernum").value;
                if(randomnumber == usernumber){
                    alert("인증 확인");
                    document.getElementById("usernum").disabled=true;
                    allcomplete = true;                    
                }
                else{
                    alert("인증 실패, 다시 입력하세요");
                    document.getElementById("usernum").value="";
                }
            }
        });
    </script>

    <script>
        // 회원 가입 클릭 시
        document.getElementById("complete_regist").addEventListener("click",function(){
            const id_input_check = document.getElementById("IdcheckFields").textContent;
            if(id_input_check.includes("가능한")){
                if(allcomplete && pw_input_check){
                    var adduserid = document.getElementById("newID").value;
                    var adduserpw = document.getElementById("newPW").value;
                    var addusername = document.getElementById("Username").value;
                    var addemailaddress = document.getElementById("emailaddress").value;                    
                    alert(addusername +"님 환영합니다.");
                    $.ajax({
                        type: "POST",
                        url: "/register",
                        data: {adduserid:adduserid,
                            adduserpw:adduserpw,
                            addusername:addusername,
                            addemailaddress:addemailaddress},
                        success: function(response){                            
                            window.location.href = "/";                            
                        }
                    });
                }
                else{
                    alert("인증 번호 확인을 해주세요.");
                }
            }
            else{
                alert("다시 시도해주세요");
                document.getElementById("newID").value = "";
                document.getElementById("newPW").value= "";
                document.getElementById("newPWcheck").value ="";
                document.getElementById("Username").value= "";
                document.getElementById("emailaddress").value= "";                
                document.getElementById("usernum").value= "";
                document.getElementById("usernum").disabled=false;
                document.getElementById("IdcheckFields").textContent = "";
                document.getElementById("PWmatchcheck").textContent = "";
                allcomplete = false;
            }
            event.preventDefault();
        });
    </script>

    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../static/lib/wow/wow.min.js"></script>
    <!--script src="../static/lib/easing/easing.min.js"></script-->
    <!--<script src="../static/lib/waypoints/waypoints.min.js"></script>-->
    <script src="../static/lib/counterup/counterup.min.js"></script>
    <script src="../static/lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="../static/lib/isotope/isotope.pkgd.min.js"></script>

    <!-- Template Javascript -->
    <script src="../static/js/main.js"></script>
</body>

</html>