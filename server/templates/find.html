<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>아이디/비밀번호 찾기</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500&family=Roboto:wght@500;700;900&display=swap"
        rel="stylesheet">

    <!-- Icon Font Stylesheet -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">
    
    <!-- Libraries Stylesheet -->
    <link href="../static/lib/animate/animate.min.css" rel="stylesheet">
    <link href="../static/lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">

    <!-- Customized Bootstrap Stylesheet -->
    <link href="../static/css/bootstrap.min.css" rel="stylesheet">

    <!-- Template Stylesheet -->
    <link href="../static/css/style.css" rel="stylesheet">
</head>

<body>
    <!-- Start -->
    <div class="container-fluid bg-light overflow-hidden px-lg-0">
        <div class="container quote px-lg-0">
            <div class="row g-0 mx-lg-0 justify-content-center align-items-center">
                <div class="col-lg-6 p-lg-5">
                    <div class="bg-primary mb-2" style="width: 90px; height: 2px;"></div>
                    <h5 class="display-7">아이디 찾기</h5>
                    
                    <form class="form-signin" action="/find" method="POST">
                        <div class="row g-3">
                            <div class="col-12">
                                <input type="text" class="form-control border-0" name="find_name" id="find_name" placeholder="이름"
                                    style="height: 55px;">
                            </div>
                            <div class="col-12">
                                <div class="col-12 d-flex justify-content-between">
                                    <input type="text" class="form-control border-0" name="find_email" id="find_email" placeholder="이메일 주소"
                                        style="height: 55px;">
                                    <div style="width: 40px;"></div>
                                    <button class="btn btn-primary" 
                                        style="min-width:130px;" type="submit" onclick="id_find()">아이디 찾기</button>
                                </div>
                                <div class="col-12" style="display:none;" id="idfindfield">
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="bg-primary mb-2" style="width: 90px; height: 2px;"></div>
                                <div>
                                    <h5 class="display-7">비밀번호 재설정</h5>
                                </div>
                                <input type="text" class="form-control border-0" id ="info_id" placeholder="아이디"
                                    style="height: 55px;">
                            </div>
                            <div class="col-12">
                                <input type="text" class="form-control border-0" id="info_name" placeholder="이름"
                                    style="height: 55px;">
                            </div>
                            <div class="col-12 d-flex justify-content-between">
                                <input type="text" class="form-control border-0" id="emailaddress" placeholder="이메일 주소"
                                    style="height: 55px;">
                                <div style="width: 40px;"></div>
                                <button class="btn btn-primary" type="button" id="emailcheckbtn"
                                    style="min-width:100px;">인증 요청</button>
                            </div>                           
                            <div class="col-12" id="verificationFields" style="display: none;">
                                <div class="col-12 d-flex justify-content-between">
                                    <input type="text" class="form-control border-0" id="usernum" placeholder="인증 번호" style="height: 50px;">
                                    <div style="width: 40px;"></div>
                                    <button class="btn btn-primary" type="button" id="numbercheck" style="min-width: 100px;">확인</button>
                                </div>
                            </div>
                            <div class="col-12" id="updatepwfield" style="display :none;">
                                <input type="password" class="form-control border-0" id="updatePW" placeholder="비밀번호 재설정"
                                    style="height: 55px;">
                            </div>
                            <div class="col-12 mb-2" id="updatepwcheckfield" style="display :none;" >
                                <input type="password" class="form-control border-0" id="updatePWcheck" placeholder="비밀번호 재설정 확인"
                                    style="height: 55px;">
                                <div class="col-12" id="updatepwmatchcheck"></div>
                            </div>                            
                            <div class = "col-12"> </div>
                            </div>
                            <div class="col-12">
                                <button class="btn btn-primary w-100 py-3" type="submit" id="complete_updatepw">비밀번호 변경하기</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!--/*** This template is free as long as you keep the footer author’s credit link/attribution link/backlink. If you'd like to use the template without the footer author’s credit link/attribution link/backlink, you can purchase the Credit Removal License from "https://htmlcodex.com/credit-removal". Thank you for your support. ***/-->
    <!--Designed By <a class="border-bottom" href="https://htmlcodex.com">HTML Codex</a>
    </div>
    </div>
    </div>
    </div> -->
    <!-- Copyright End -->

    <!-- 이벤트 발생 시 -->
    <script>
        // 아이디 정규식
        document.getElementById("info_id").addEventListener("input",function() {
            var user_newID = document.getElementById("info_id").value;
            var clean_newID = user_newID.replace(/[^A-Za-z0-9]/g,"");
            if(user_newID != clean_newID){
                alert("영어와 숫자 이외의 문자는 입력할 수 없습니다.");
            }
            document.getElementById("info_id").value = clean_newID;
        });
        // 비밀번호 정규식
        document.getElementById("updatePW").addEventListener("input",function() {
        var user_updatePW = document.getElementById("updatePW").value;
        var clean_updatePW = user_updatePW.replace(/[^A-Za-z0-9-~!@#$%^&*]/g,"");
        clean_updatePW = clean_updatePW.slice(0,20);
        if(user_updatePW != clean_updatePW){
            alert("최대 20글자이고,\n특수문자는 ~!@#$%^&*만 입력가능합니다.");
        }
        document.getElementById("updatePW").value = clean_updatePW;
        });   
        // 이름 정규식
        document.getElementById("find_name").addEventListener("input",function() {
            var username = document.getElementById("find_name").value;            
            var cleanusername = username.replace(/[^가-힣ㄱ-하-ㅣ]/g,"");
            if(username != cleanusername){
                alert("한글 이외의 문자는 입력할 수 없습니다.");
            }
            document.getElementById("find_name").value = cleanusername;
        });
        document.getElementById("info_name").addEventListener("input",function() {
            var infoname = document.getElementById("info_name").value;            
            var cleaninfoname = infoname.replace(/[^가-힣ㄱ-하-ㅣ]/g,"");
            if(infoname != cleaninfoname){
                alert("한글 이외의 문자는 입력할 수 없습니다.");
            }
            document.getElementById("info_name").value = cleaninfoname;
        });         
    </script>

    <script>
        // 아이디 찾기 버튼 클릭 이벤트        
        function id_find(){
            event.preventDefault(); // 기본 동작(페이지 새로고침) 중지
            const findid_name = document.getElementById("find_name").value;
            const findid_email = document.getElementById("find_email").value;

            var email = document.getElementById("find_email").value;
            var emailpattern = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
        
            if (!email.match(emailpattern)) {
                alert("올바른 이메일 주소를 입력하세요.");
                document.getElementById("find_email").value = "";
                document.getElementById("find_email").focus();
            }          
            else{
                // AJAX 요청을 보냄
                $.ajax({
                    type: "POST",
                    url: "/find", // 서버의 경로 (app.py에서 처리할 경로)
                    data: {
                        findid_name: findid_name,
                        findid_email: findid_email
                    },
                    success: function (response) {  
                        const idtext = document.getElementById("idfindfield");
                        idtext.innerHTML = `<h6 class="display-7" id="idfindfield" style="color: blue;">아이디: ${response.find}</h6>`;
                        idtext.style.display = "block"; 
                    }
                });
            }
        }
    </script>

    <script>        
        var allcomplete = false;
        var update_try = false;
        // 인증 요청 버튼 클릭 이벤트
        var verificationField = document.getElementById("verificationFields");
        var ran_number = 0;
        document.getElementById("emailcheckbtn").addEventListener("click", function () {        
            // 이메일 정규식
            var email = document.getElementById("emailaddress").value;
            var emailPattern = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
        
            if (!email.match(emailPattern)) {
                alert("올바른 이메일 주소를 입력하세요.");
                document.getElementById("emailaddress").value = "";
                document.getElementById("emailaddress").focus();
            }
            else{  
                var infoid = document.getElementById("info_id").value;  
                var nameinfo = document.getElementById("info_name").value;
                if(infoid=="") {
                    alert("아이디를 확인해주세요");                    
                }
                else if(nameinfo == "" ){
                    alert("이름을 확인해주세요");
                }
                else{
                    alert("인증 요청했습니다!\n이메일에서 인증 번호를 확인해주세요");
                // 숨겨진 인증 번호 입력 필드를 보이게 만듭니다.
                verificationField.style.display = "block";

                // 새로운 인증 번호 생성
                ran_number = Math.floor(1000 + Math.random() * 9000);
                var in_email = document.getElementById("emailaddress").value;
                $.ajax({
                    type: "POST",
                    url: "/find",
                    data: {ran_number:ran_number,
                        in_email:in_email}
                    });
                }
            }
        });
        //인증 번호 일치 확인
        document.getElementById("verificationFields").addEventListener("click",function(e){
            if(e.target.id == "numbercheck"){
                var usernumber = document.getElementById("usernum").value;
                if(ran_number == usernumber){
                    alert("인증 확인");
                    document.getElementById("usernum").disabled=true;
                    allcomplete = true;   
                    matchcheck();
                }
                else{
                    alert("인증 실패, 다시 입력하세요");
                    document.getElementById("usernum").value="";
                }
            }
        });
    
        //인증 번호 일치 확인 후 함수
        function matchcheck(){
            if(allcomplete){
                var updatepw = document.getElementById("updatepwfield");
                var updatepwcheck = document.getElementById("updatepwcheckfield");
                updatepw.style.display = "block";
                updatepwcheck.style.display = "block";
                document.getElementById("updatePW").addEventListener("input",function(){
                    pwmatchcheck();
                });
                document.getElementById("updatePWcheck").addEventListener("input",function(){
                    pwmatchcheck();
                });
            }
        }
        function pwmatchcheck(){
            var update_pw = document.getElementById("updatePW").value;
            var update_pwcheck = document.getElementById("updatePWcheck").value;
            var updatepwmatchcheck = document.getElementById("updatepwmatchcheck");
            if(update_pw.length > 7){            
                if(update_pw == update_pwcheck){
                    updatepwmatchcheck.textContent ="비밀번호 일치";
                    updatepwmatchcheck.style.color = "green";
                    update_try = true;
                    if(update_pw=="" && update_pwcheck==""){
                        updatepwmatchcheck.textContent="";                        
                        update_try = false;
                    }
                }else{
                    updatepwmatchcheck.textContent ="비밀번호 불일치";
                    updatepwmatchcheck.style.color = "red";
                    update_try = false;
                }
            }
            else{
                updatepwmatchcheck.textContent ="최소 8글자 이상이어야 합니다.";
                updatepwmatchcheck.style.color = "red";
                update_try = false;
            }
        }                 
    </script>

    <script>
        // 비밀번호 변경하기 클릭 시
        document.getElementById("complete_updatepw").addEventListener("click",function(){
            var info_email = document.getElementById("emailaddress").value;
            var info_id = document.getElementById("info_id").value;  
            event.preventDefault();
            if(update_try && info_email!="" && info_id!=""){
                var pwupdate = document.getElementById("updatePW").value;
                $.ajax({
                    type: "POST",
                    url: "/find",
                    data: {pwupdate:pwupdate,
                        infoemail:info_email,
                        infoid:info_id},                    
                    success: function(response){
                        if(response['update_result'] == "fail"){
                            alert("정보가 일치하지 않습니다.");
                            document.getElementById("usernum").disabled = false;
                            update_try=false;
                            document.getElementById("usernum").value ="";
                            document.getElementById("emailaddress").value ="";
                            document.getElementById("info_id").value ="";
                            document.getElementById("info_name").value ="";
                            document.getElementById("updatePWcheck").value = "";
                            document.getElementById("updatePW").value = "";
                            var updatepw = document.getElementById("updatepwfield");
                            var updatepwcheck = document.getElementById("updatepwcheckfield");
                            updatepw.style.display = "none";
                            updatepwcheck.style.display = "none";
                        }
                        else{
                            alert("비밀번호가 변경되었습니다.");
                            window.close();                        
                        }
                    }
                });            
            }
            else{
                alert("다시 확인해주세요");
            }  
        });
    </script>

    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../static/lib/wow/wow.min.js"></script>
    <script src="../static/lib/counterup/counterup.min.js"></script>
    <script src="../static/lib/isotope/isotope.pkgd.min.js"></script>

    <!-- Template Javascript -->
    <script src="../static/js/main.js"></script>
</body>

</html>